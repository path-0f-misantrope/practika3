# Руководство системному программисту
## Идентификатор документа: RU.24301.001.32

### 1. ОБЩИЕ СВЕДЕНИЯ

**1.1. Назначение программы**
Программа "Система управления заявками на ремонт" предназначена для автоматизации процесса подачи, обработки и отслеживания статуса заявок на ремонт климатической техники. Программа обеспечивает взаимодействие между клиентами, менеджерами и мастерами через веб-интерфейс и REST API.

**1.2. Функции программы**
Программа выполняет следующие основные функции:
*   Аутентификация пользователей (JWT).
*   Создание заявок на ремонт клиентами.
*   Назначение мастеров на заявки менеджерами.
*   Обновление статуса и деталей заявки (диагностика, запчасти) мастерами.
*   Просмотр списка заявок с фильтрацией по ролям.
*   Сбор и отображение статистики (KPI мастеров, эффективность, типы поломок).
*   Создание резервных копий базы данных (утилита db_dump).

**1.3. Требования к техническим средствам**
*   Процессор: x86-64, 2 ядра и выше.
*   Оперативная память: не менее 1 ГБ.
*   Дисковое пространство: не менее 100 МБ для бинарных файлов и логов + пространство для БД.

**1.4. Требования к программным средствам**
*   Операционная система: Linux (рекомендуется Ubuntu 20.04+), Windows 10/11, macOS.
*   СУБД: PostgreSQL версии 13 и выше.
*   Среда исполнения: Go (Golang) версии 1.21+ (для сборки из исходных кодов).

### 2. СТРУКТУРА ПРОГРАММЫ

**2.1. Состав дистрибутива**
В комплект поставки входят:
1.  Исполняемый файл сервера: `server.exe` (или `server` на Linux).
2.  Файл фронтенда: `index.html` (должен находиться в рабочей директории сервера).
3.  Утилита резервного копирования: `db_dump.exe` (в `cmd/db_dump/`).
4.  Файлы конфигурации (зашиты в код или `.env`, при наличии).

**2.2. Взаимодействие модулей**
*   **Main**: Точка входа, инициализация подключения к БД, настройка роутера Gin, запуск HTTP-сервера.
*   **Handlers**: Обработчики HTTP-запросов (слой контроллеров).
*   **DB Layer**: Функции прямого доступа к PostgreSQL (pgx).
*   **Auth**: Модуль генерации и валидации JWT.

### 3. НАСТРОЙКА ПРОГРАММЫ

**3.1. Установка**
1.  Развернуть PostgreSQL и создать базу данных (по умолчанию `postgres`).
2.  Выполнить инициализацию схемы БД (см. раздел "Создание таблиц" в Руководстве администратора или использовать `dump.sql`).
3.  Скомпилировать программу:
    ```bash
    go build -o server.exe main.go
    ```

**3.2. Настройка конфигурации**
Настройка осуществляется путем изменения констант в исходном коде или переменных окружения (если реализовано).
Основные параметры подключения к БД (строка 1050 в `main.go`):
`postgres://postgres:zxcqwe123@localhost:5432/postgres`

Для изменения параметров подключения необходимо:
1.  Отредактировать DSN строку в файле `main.go`.
2.  Пересобрать приложение.

**3.3. Проверка работоспособности**
1.  Запустить сервер: `./server.exe`.
2.  Убедиться в появлении сообщения `Сервер запущен на :8080`.
3.  Открыть в браузере `http://localhost:8080` (если настроена раздача статики) или проверить API через Postman: `GET http://localhost:8080/api/statistics`.

### 4. ОБСЛУЖИВАНИЕ

**4.1. Резервное копирование**
Для создания дампа базы данных используется утилита `db_dump`.
Запуск:
```bash
./db_dump.exe
```
Результат: файл `dump.sql` в текущей директории.

**4.2. Восстановление данных**
Восстановление производится стандартными средствами PostgreSQL:
```bash
psql -U postgres -d postgres -f dump.sql
```

**4.3. Обновление**
Для обновления версии программы необходимо:
1.  Остановить текущий процесс сервера.
2.  Заменить исполняемый файл `server.exe` на новый.
3.  При наличии изменений в структуре БД, выполнить миграции (или восстановить совместимый дамп).
4.  Запустить сервер.

### 5. СООБЩЕНИЯ СИСТЕМНОМУ ПРОГРАММИСТУ

В данной версии программы сообщения об ошибках выводятся в стандартный поток вывода (STDOUT/STDERR).

*   `Не удалось подключиться к БД`: Проверьте доступность PostgreSQL и корректность credentials.
*   `Сервер запущен на :8080`: Нормальный запуск.
*   `panic: ...`: Критическая ошибка, требующая анализа стека вызовов и обращения к разработчику.

---

